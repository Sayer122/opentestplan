#!/bin/sh

cd /app
export PGPASSWORD=$DB_PASSWORD

# Start PostgreSQL and wait for it to be ready
echo "Waiting for db to be ready..."
until pg_isready -h $DB_HOST -p $DB_PORT -U $DB_USER; do
  sleep 2;
done
echo "PostgreSQL started"

# Run the SQL script to create the database
psql -h $DB_HOST -p $DB_PORT -U $DB_USER -d $DB_NAME -f ./init.sql

# Run the SQL script to create the initial admin user
node create-initial-user.js

# Start the app
npm start &

# Start Nginx
nginx -g 'daemon off;'
